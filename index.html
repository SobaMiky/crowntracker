<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monster Hunter Wilds - Crown Tracker</title>
    <link rel="shortcut icon" href="./icons/geli.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

        body {
            font-family: "Roboto", sans-serif;
        }

        #monsterTable tbody tr {
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        #monsterTable tbody tr:hover td {
            background-color: hsla(210, 11%, 14%, 0.15) !important;
        }

        .table img {
            max-width: 45px;
            height: auto;
        }

        /* Forza la tabella a non strabordare */
        div.dataTables_wrapper {
            width: 100%;
            overflow-x: auto;
        }

        table.dataTable {
            width: 100% !important;
            table-layout: fixed;
        }

        th,
        td {
            word-wrap: break-word;
        }
    </style>
</head>

<body class="bg-secondary">
    <div class="header container-fluid text-center">
        <h3>Wilds - Crown Tracker</h3>
        <p>by Soba</p>
    </div>

    <div class="container-fluid mb-3">
        <button id="toggleCompleted" class="btn btn-primary">Mostra/Nascondi completati</button>
    </div>

    <div class="table-responsive">
        <table class="table table-dark" id="monsterTable">
            <thead>
                <tr>
                    <th></th>
                    <th>Monster</th>
                    <th>Progress</th>
                    <th>Mini Crown</th>
                    <th>Large Crown</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">Conferma azione</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Chiudi"></button>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-primary" id="confirmAction">Conferma</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

    <script>
        let monsters = JSON.parse(localStorage.getItem('monsters'));
        if (!monsters || monsters.length === 0) {
            monsters = [
                { id: 1, name: 'Chatacabra', minicrown: 0, giantcrown: 0 },
                { id: 2, name: 'Quematrice', minicrown: 0, giantcrown: 0 },
                { id: 3, name: 'Lala Barina', minicrown: 0, giantcrown: 0 },
                { id: 4, name: 'Congalala', minicrown: 0, giantcrown: 0 },
                { id: 5, name: 'Balahara', minicrown: 0, giantcrown: 0 },
                { id: 6, name: 'Doshaguma', minicrown: 0, giantcrown: 0 },
                { id: 7, name: 'Uth Duna', minicrown: 0, giantcrown: 0 },
                { id: 8, name: 'Rompopolo', minicrown: 0, giantcrown: 0 },
                { id: 9, name: 'Rey Dau', minicrown: 0, giantcrown: 0 },
                { id: 10, name: 'Nerscylla', minicrown: 0, giantcrown: 0 }
            ];
            localStorage.setItem('monsters', JSON.stringify(monsters));
        }

        let selectedMonsterIndex = null;
        let selectedCrownType = null;

        function buildTable(data) {
            $('#tableBody').html('');
            data.forEach(monster => {
                $('#tableBody').append(`
            <tr>
                <td><img src="./icons/${monster.name.toLowerCase().replace(/[^a-z0-9]/g, '')}.png" /></td>
                <td>${monster.name}</td>
                <td>${monster.minicrown + monster.giantcrown === 2 ? '100%' : monster.minicrown + monster.giantcrown === 1 ? '50%' : '0%'}</td>
                <td class="text-center fw-bold ${monster.minicrown ? 'text-success' : 'text-danger'}">${monster.minicrown ? 'Mini Crown Obtained' : 'N/A'}</td>
                <td class="text-center fw-bold ${monster.giantcrown ? 'text-success' : 'text-danger'}">${monster.giantcrown ? 'Giant Crown Obtained' : 'N/A'}</td>
            </tr>
        `);
            });
        }

        $(document).ready(function () {
            buildTable(monsters);

            let monsterTable = $('#monsterTable').DataTable({
                responsive: true,
                pageLength: 100,
                lengthMenu: [50, 100, 200],
                language: {
                    lengthMenu: "Mostra _MENU_ entries",
                    search: "Search: "
                },
                dom: "<'row mb-2'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row mt-2'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>"
            });

            $('#toggleCompleted').click(function () {
                monsterTable.rows().every(function () {
                    let progress = $(this.node()).find('td:eq(2)').text();
                    if (progress === '100%') $(this.node()).toggle();
                });
            });

            $('#monsterTable tbody').on('click', 'td', function () {
                let colIndex = monsterTable.cell(this).index().column;
                if (colIndex === 3) selectedCrownType = 'minicrown';
                else if (colIndex === 4) selectedCrownType = 'giantcrown';
                else return;

                selectedMonsterIndex = monsterTable.row(this).index();
                let monster = monsters[selectedMonsterIndex];
                let crownName = selectedCrownType === 'minicrown' ? 'mini crown' : 'large crown';
                let currentValue = monster[selectedCrownType];

                $('#confirmModal .modal-body').html(currentValue === 0 ?
                    `Confermi di aver ottenuto la <strong>${crownName}</strong> per <strong>${monster.name}</strong>?` :
                    `Vuoi annullare la <strong>${crownName}</strong> per <strong>${monster.name}</strong>?`
                );

                new bootstrap.Modal(document.getElementById('confirmModal')).show();
            });

            $('#confirmAction').click(function () {
                if (selectedMonsterIndex !== null && selectedCrownType) {
                    monsters[selectedMonsterIndex][selectedCrownType] = monsters[selectedMonsterIndex][selectedCrownType] ? 0 : 1;
                    localStorage.setItem('monsters', JSON.stringify(monsters));
                    monsterTable.clear().destroy();
                    buildTable(monsters);
                    monsterTable = $('#monsterTable').DataTable({
                        responsive: true,
                        pageLength: 100,
                        lengthMenu: [50, 100, 200],
                        language: { lengthMenu: "Mostra _MENU_ entries", search: "Search: " },
                        dom: "<'row mb-2'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                            "<'row'<'col-sm-12'tr>>" +
                            "<'row mt-2'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>"
                    });
                }
                bootstrap.Modal.getInstance(document.getElementById('confirmModal')).hide();
                selectedMonsterIndex = null;
                selectedCrownType = null;
            });
        });
    </script>
</body>

</html>